## 세그먼테이션/페이징 혼용 기법

세그먼테이션 기법의 단점은 세그먼트가 너무 가변적인 길이고, 떄로는 그 크기가 지나치게 커서 주기억장치에 적재할 수 없는 경우가 있을 수 있다는 것이다.

그래서 하나의 세그먼트를 정수 배의 페이지로 다시 분할하는 세그먼트/페이징 혼용 기법이 연구되었다.

이 방법에서 세그먼트를 통상 그 크기가 페이지의 정수 배로 이루어지고, 한 세그먼트의 모든 페이지들이 동시에 주기억 장치에 존재할 필요가 없다.

따라서 가상 메모리상에서 연속된 페이지들이 주기억장치에서도 반드시 연속적일 필요가 없다는 것이 특징이다.

세그먼트/페이징 혼용 시스템에서의 가상 주소 v는 3차원의 요소로 구성되고, 그 형식은 v = (s,p,d)로 나타낸다. 여기서 s는 세그먼트 번호이고,

p는 페이지 번호, d는 페이지 내에서의 원하는 항목이 위치하는 변위이다.

<br>

------------------------------------------------------------------------------------------------------------------------

### 동적 주소 변환

우선 (s,p)를 찾기 위해서 연관기억장치(associative memory)에 대한 연관 탐색이 수행된다.

연관기억장치 내에는 최근에 참조된 세그먼트의 페이지 항목들이 들어 있는 연관기억장치 사상 테이블이 위치한다.

만약 (s,p)가 이 테이블에서 발견되면, 이 페이지가 들어 있는 주기억장치 내의 페이지 프레임 p'와 변위 d를 접속하여 가상 주소 v = (s,p,d)에 대응하는 주기억장치의 주소인 r = p' + d를 
구함으로써 주소 변환이 끝난다.

정상적인 경우 대부분의 주소 변환에 대한 요구는 이러한 연관기억장치 탐색에 의하여 해결되며, 그렇지 못할 경우에는 직접 사상을 위한 완전한 광정이 요구된다.

우선 세그먼트 사상 테이블 시작점 레지스터에서 세그먼트 사상 테이블의 시작 주소 b를 찾고 이 값에 세그먼트 번호 s를 더하여 주소 b+s를 구한다.

이 주소는 세그먼트 사상 테이블 내의 해당 세그먼트 항목이 위치하는 주기억장치 상의 실제 주소가 되는 것이다.

이 주소에서 위치하는 세그먼트 항목 s에 대한 페이지 사상 테이블의 시작 주소 s'를 다시 페이지 번호 p에 더하여 주소 p+s' 를 구한다.

이 주소는 페이지 사상 테이블 내의 해당 세금너트의 페이지 항목이 위치하는 주기억장치의 실제 주소이다. 

이 주소에 위치하는 페이지 목에서 가상 페이지 p에 해당하는 페이지 프레임 번호 p'를 찾아낸다.

그 후 페이지 프레임 번호 p'는 다시 변위 d와 접속되어, 가상 주소 v = (s,p,d)에 대응되는 실제 주소 r = p' + d을 형성하게 된다.

이상의 과정에서, 세그먼트 사상 테이블의 검색 결과 세그먼트 s가 주기억장치 내의 존재하지 않음이 판명되면 세그먼트 부재 결합(segment missing fault)이 발생한다.

이때는 운영체제가 제어를 받아 보조기억장치에 있는 해당 세그먼트의 위치를 찾고, 그 세그먼트에 대한 테이블 항목을 만든 후, 

그 프로세스 또는 다른 프로세스의 기존의 페이지를 교체하면서 필요한 페이지를 주기억장치로 적재하게된다.

만일 세그먼트 s가 주기억장치 내에 있다고 해도 페이지 사상 테이블에서 해당 페이지를 참조하는 과정에서 원하는 페이지가 주기억장치 내에 없다는 것이 판명될 수 있다.

이때는 ***페이지 부재결함을 발생***시켜, 운영체제가 제어를 받아 보조기억장치에서 그 페이지의 위치를 찾아 필요한 페이지를 적재한다.

순수한 세그먼테이션 기법에서와 같이 가상 주소가 세그먼트의 경계를 넘어서는 경우가 있을 수 있는데, 그러한 경우 ***세그먼트 오버플로우 결함(segment overflow fault)***이 발생된다.

또 참조된 가상 주소에서 대해 요구되는 작업이 보호 비트와 비교하여 허용되지 않는 작업임이 판명될 때 ***세그먼트 보호 결함(segment protection fault)***이 발생된다.

<br>

------------------------------------------------------------------------------------------------------------------------


### 시스템의 공유

세그먼트/페이징 혼용 시스템에 있어도 공유의 문제는 중요한 가치를 가졌는데,

이 시스템에서 세그먼트의 공유는 서로 다른 프로세스의 세그먼트 사상 테이블의 항목들이 동일 페이지 사상 테이블을 공유함으로써 이루어진다.

이 공유의 문제에서 특히 주목해야 할 내용은 ***주기억장치에 새로이 적재되는 페이지가 여러 프로세스에 의해 공유되는 페이지를 대체할 때 발생할 수 있는 문제점을 신중히 고려하여야 한다는 점***이다.
