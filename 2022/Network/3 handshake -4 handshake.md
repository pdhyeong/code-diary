## 3 handshake

TCP의 3 handshake란 논리적인 접속을 성립(establish) 하기 위해 3 handshake를 사용한다.

TCP/IP 프로토콜을 이용해서 통신을 하는 응용프로그램이 데이터를 전송하기 전에 먼저 정확한 전송을 보장하기 위해 상대방 컴퓨터와 사전에 세션을 수립하는 과정을 의미한다.

간단하게 단계로 보면

클라이언트에서 먼저 서버에게 접속 요청하는 SYN패킷을 보낸다. 이때 클라이언트는 SYN을 보내고 SYN/ACK 응답을 기다리는 SYN_SENT 상태가 된다. 

서버는 SYN 요청을 받고 클라이언트에게 요청을 수락한다는 ACK와 SYN flag가 설정된 패킷을 발송하고 클라이언트가 다시 ACK로 응답하기를 기다린다. 이떄 SYN_RECEIVED 상태가 된다.

클라이언트는 서버에게 ACK을 보내고 이후로부터는 연결이 이루어지고 데이터가 오가게 된다.
이때 서버가 성립상태가 되는것.

------------------------------------------------------------

## 4 handshake

4 handshake는 연결한 세션을 종료하기 위해 수행되는 절차를 말한다.

여기서도 간단하게 단계적으로 보면

클라이언트가 연결을 종료하겠다는 FIN플래그를 전송한다.

서버가 일단 확인메시지를 보내고 자신의 통신이 끝날때까지 기다리는데 이 상태가 TIME_WAIT상태다.

서버가 통신이 끝났으면 연결이 종료되었다고 클라이언트에게 FIN플래그를 전송한다.

클라이언트는 확인 메시지를 보낸다.

서버에서 FIN을 전송하기 전에 전송한 패킷이 routing 지연이나 유실로 인한 재전송 같은 이유로 FIN 패킷보다 늦게 도착하게 되면 Drop 되거나 유실된다. 

이와 같은 상황을 대비하여 FIN을 수신하더라도 일정시간 동안 세션을 남겨놓고 잉여 패킷을 기다리는 과정을 거치는데 이것을 TIME_WAIT이라고 한다.


< 참조 : blog.naver.com, webstylez.egloos.com, blazebyte.blogspot.kr>
